make_col path:lower(string(EXTRA.path))
filter contains(string(path), "firewall")

// base
make_table
pick_col
  EventTime:parse_isotime(string(FIELDS.timestamp)),
  SubType:string(FIELDS.subtype),
  Action:string(FIELDS.action),
  User:string(FIELDS.user),
  RemoteIP:string(FIELDS.remip)

filter SubType = "vpn" and not is_null(EventTime)
make_col action_l:lower(string(Action))
filter (action_l = "tunnel-up" or action_l = "login")

aggregate group_by(User),
  Successes:count(),
  DistinctRemoteIPs:count_distinct(RemoteIP),
  FirstSeen:min(EventTime),
  LastSeen:max(EventTime)

filter (DistinctRemoteIPs >= 5 and Successes >= 10)
sort desc(DistinctRemoteIPs), desc(Successes)
limit 200
